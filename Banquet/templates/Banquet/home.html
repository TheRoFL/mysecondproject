{% extends 'index.html' %}

<!-- prettier-ignore -->
{% block content %} {% load static %}
<h1>Формирование банкета</h1>
<head>
  <script>
    var username_id_added = "{{user.id}}";
    var current_client_id_added = "{{current_client.id}}";
    var current_client_name = "{{current_client.type}}";
    localStorage.setItem("username_id", username_id_added);
    localStorage.setItem("current_client_id", current_client_id_added);
    localStorage.setItem("dishFilter", current_client_id_added);
    localStorage.setItem("current_client_name", current_client_name);
    var username_id = localStorage.getItem("username_id");
    var current_client_id = localStorage.getItem("current_client_id");
  </script>

  <link rel="stylesheet" href="/static/styles/banquet.css" />
</head>
<body>
  <div class="body">
    <form id="clientForm" style="margin-left: 10px">
      <label for="clientName">Название клиента:</label>
      <input type="text" id="clientName" required />

      <label for="clientCount">Количество клиентов:</label>
      <input type="number" id="clientCount" required />
      <br />

      <button type="submit">Сохранить</button>
      <button type="button" id="cancelFormBtn">Отменить</button>
    </form>
    <div class="vseClients" id="all_clients">
      <!-- prettier-ignore -->
      {% if banquet.clients.all %} 
      {% for client in banquet.clients.all %}
      <div
        class="my_client formaClienta menu-client-btn"
        data-id="{{client.id}}"
        data-name="{{client.type}}"
      >
        <div class="formaClienta_header">
          <input
            class="name-input"
            data-id="{{client.id}}"
            value="{{ client.type }}"
          />
          <p
            style="
              font-size: 10px;
              display: inline;
              color: #fff;
              margin-bottom: 12px;
            "
          >
            x
          </p>
          <input
            class="quantity-input"
            data-id="{{client.id}}"
            value="{{ client.quantity }}"
            pattern="[A-Za-z]{3}"
          />

          <button
            class="delete-client-btn"
            data-id="{{client.id}}"
            data-name="{{client.type}}"
          >
            <img
              data-id="{{client.id}}"
              class="musorka"
              src="/static/images/Мусорка.png"
              alt="delete"
            />
          </button>
        </div>
        <div
          class="vash_zakaz"
          data-id="{{client.id}}"
          data-name="{{client.type}}"
        >
          <div class="client-menu" data-id="{{client.id}}">
            {% if client.menu %}
            <div class="client-menu-btn">
              <h1 style="display: inline-block">{{client.menu}}</h1>
              <button
                class="delete-menu-btn"
                data-id="{{client.menu.id}}"
                data-clientId="{{client.id}}"
                style="margin-top: 0px"
              >
                Удалить
              </button>
            </div>
            {% for dish in client.menu.dishes.all %}
            <div class="client-menu-dish" data-id="{{dish.id}}">
              <h1 style="margin-left: 25px">
                -{{dish.product.name}} x {{dish.quantity}} шт. =
                {{dish.price_count}}.00 руб.
              </h1>
            </div>
            {% endfor %}
            <h1 style="margin-left: 15px">
              Итого:
              <span class="menu-total" data-id="{{client.menu.id}}"
                >{{client.menu.all_dishes_price}}</span
              >.00 руб. с человека
            </h1>
            <h1>----------------------------------------------</h1>
            {%endif%}
          </div>

          <div class="additional-dishes" data-id="{{client.id}}">
            {% if client.dishes.all %} {% if client.menu %}
            <h1 style="margin-left: 15px">Дополнительно:</h1>
            {% else %}
            <h1 style="margin-left: 15px">Выбранные блюда:</h1>
            {% endif %} {% for client_dish in client.dishes.all %}
            <div class="adittional-dish" data-id="{{client_dish.id}}">
              <div class="adittional-dish-item">
                <h2 style="margin-left: 30px">
                  {{client_dish.product.name}} x
                  <span
                    class="client_order_quantity"
                    data-id="{{client.id}}"
                    id="{{client_dish.id}}"
                    >{{client_dish.quantity}}
                  </span>
                  шт. =

                  <span
                    class="client_order_price"
                    data-id="{{client.id}}"
                    id="{{client_dish.id}}"
                    >{{client_dish.price_count}}</span
                  >.00 руб.
                </h2>
              </div>
              <div class="adittional-dish-item-button">
                <button
                  class="delete-btn"
                  data-id="{{client_dish.id}}"
                  data-clientId="{{client.id}}"
                >
                  X
                </button>
              </div>
            </div>

            {% endfor %}
            <h1>----------------------------------------------</h1>
            {% endif %}
          </div>

          <div class="client-total-price">
            Итого:
            <span
              class="order-price-count"
              data-id="{{client.id}}"
              id="{{client.id}}"
            >
              {{client.total_client_price}}</span
            >.00 руб. x
            <span class="client-quantity" data-id="{{client.id}}"
              >{{client.quantity}}</span
            >
            человек =
            <span
              class="client-price-count"
              data-id="{{client.id}}"
              id="{{client.id}}"
              >{{client.menu_and_orders_price_count}}</span
            >.00 руб.
          </div>
        </div>
        <button class="details-button" data-id="{{client.id}}">
          Подробнее
        </button>
      </div>

      {% endfor %} {% endif %}
      <button id="showFormBtn" class="formaClienta">+</button>
    </div>
    <div class="overflow2 hidden2"></div>
    <div class="menuu hidden2">
      <div class="dd-f">
        <button
          class="dish-filter {% if dish_type == 'samples' %}active{% endif %}"
          data-filter="samples"
          id="requestButton"
        >
          Готовые меню
        </button>
        <button
          class="dish-filter {% if dish_type == 'samples' %}active{% endif %}"
          data-filter="all"
          id="requestButton"
        >
          Все блюда
        </button>
        <button
          class="dish-filter {% if dish_type == 'salads' %}active{% endif %}"
          data-filter="salads"
          id="requestButton"
        >
          Салаты
        </button>
        <button
          class="dish-filter {% if dish_type == 'hot_dishes' %}active{% endif %}"
          data-filter="hot_dishes"
          id="requestButton"
        >
          Горячие блюда
        </button>
        <button
          class="dish-filter {% if dish_type == 'drinks' %}active{% endif %}"
          data-filter="drinks"
          id="requestButton"
        >
          Напитки
        </button>
        <button
          class="dish-filter {% if dish_type == 'desserts' %}active{% endif %}"
          data-filter="desserts"
          id="requestButton"
        >
          Десерты
        </button>
      </div>
      {% if dish_type != 'samples' %}
      <div class="grid-container">
        {% for current_dish in current_dishes %}
        <div class="grid-item">
          <h2>
            <button
              class="order-button"
              data-id="{{current_dish.id}}"
              data-name="{{current_dish.tittle}}"
            >
              {% if current_client %} Добавить для "<span
                class="client-name-2"
                data-id="{{client.id}}"
                >{{current_client.type}}</span
              >" {%else%} Выберите клиента {% endif %}
            </button>
          </h2>
        </div>

        {% endfor %}
      </div>

      {% else %}
      <!-- prettier-ignore -->
      <div class="grid-container">
      {% for menu_sample in current_dishes %}

      <h1>{{menu_sample}} текст чтобы  </h1>
      <h2>
        <button
          class="order-button"
          data-id="{{menu_sample.id}}"
          data-name="{{menu_sample.type}}"
        >
          {% if current_client %} Добавить для "<span
            class="client-name-2"
            data-id="{{client.id}}"
            >{{current_client.type}}</span
          >" {%else%} Выберите клиента {% endif %}
        </button>
      </h2>
       {% for dish in menu_sample.dishes.all %}
        <div class="grid-item dishes"    
          data-tittle="{{dish.product.create_tittle2}}"
          data-name="{{dish.product.name}}"
          data-weight="{{dish.product.weight}}"
          data-price="{{dish.product.price}}"
          data-sostav="{{dish.product.ingredients}}"
          data-type="{{dish.product.type}}"
        >
          <img
            src="http://localhost:8000/media/menu_images/{{dish.product.type}}/{{dish.product.create_tittle2}}.png"
        />
          <h3>{{dish.product.name}} / {{dish.product.weight}} гр. / {{dish.product.price}} руб.</h3>
        </div>
      {% endfor %}
      <h1>--------------------------------------------------------------------------------</h1>
      
      {% endfor %}
    </div>

      {% endif %}
    </div>
    <h1>&nbsp</h1>
    <hr style="width: 90%; height: 3px; background: #4a644b" />
    <h1>&nbsp</h1>
    <!-- prettier-ignore -->

    <h1>
      Сумма заказа:
      <span class="banquet-total-price" data-id="{{banquet.id}}"
        >{{banquet.total_price}}.00 руб.
      </span>
      <button class="confirm-order">
        <a href="/banquet/ordering/">Оформить заказ</a>
      </button>
    </h1>
  </div>

  <h1>&nbsp</h1>
  <hr style="width: 90%; height: 3px; background: #4a644b" />
  <h1>&nbsp</h1>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/static/js/banquet_changing.js"></script>
  <script src="/static/js/banquet_filters.js"></script>
  <script src="/static/js/banquet_edit_links.js"></script>
  <script src="/static/js/test.js"></script>
  <script src="/static/js/banquet_animations.js"></script>

  <script>
    $(".my_client").each(function () {
      if ($(this).find(".vash_zakaz").hasClass("active")) {
        $(this).addClass("green-border"); // Добавляем класс для зеленой рамки
      }
    });
  </script>
  <script>
    function formatInteger(integer) {
      if (typeof integer === "number" && Number.isInteger(integer)) {
        const integerStr = integer.toLocaleString("en-US"); // Преобразование числа в строку с разделением тысяч
        const parts = integerStr.split(",");

        // Разделение на разряды
        let formattedInteger = "";
        while (parts.length > 0) {
          if (formattedInteger.length > 0) {
            formattedInteger = " " + formattedInteger;
          }
          formattedInteger = parts[parts.length - 1] + formattedInteger;
          parts.pop();
        }

        return formattedInteger;
      } else {
        return "Invalid input";
      }
    }

    let clientPriceCount = document.querySelectorAll(".client-price-count");
    clientPriceCount.forEach((button) => {
      let value = parseInt(button.textContent);
      if (!isNaN(value)) {
        let formattedValue = formatInteger(value);
        button.textContent = formattedValue;
      }
    });
  </script>
</body>
{% endblock content %}
